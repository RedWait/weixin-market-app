<!--pages/products/products.wxml-->
<navigation-bar title="商品" showBack="{{false}}" textColor="black" backgroundColor="white" />

<view class="container">
  <!-- 分类列表 -->
  <scroll-view class="category-scroll" scroll-x="true">
    <view class="category-list">
      <view 
        class="category-item {{selectedCategoryId === null ? 'active' : ''}}"
        bindtap="loadAllProducts"
      >
        <text class="category-icon">📊</text>
        <text class="category-name">全部</text>
      </view>
      <view 
        wx:for="{{categories}}" 
        wx:key="id"
        class="category-item {{selectedCategoryId === item.id ? 'active' : ''}}"
        data-id="{{item.id}}"
        bindtap="onCategorySelect"
        data-category-id="{{item.id}}"
      >
        <text class="category-icon">{{item.icon}}</text>
        <text class="category-name">{{item.name}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- 商品列表 -->
  <view class="products-container">
    <t-loading wx:if="{{loading}}" theme="circular" size="40rpx" text="加载中..." />
    
    <t-grid wx:else column="{{2}}" gutter="{{20}}">
      <t-grid-item 
        wx:for="{{products}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="onProductTap"
      >
        <view class="product-card">
          <t-image 
            src="{{item.images[0]}}" 
            mode="aspectFill"
            width="100%"
            height="300rpx"
            lazy
            error="/images/placeholder.png"
          />
          <view class="product-info">
            <view class="product-name">{{item.name}}</view>
            <view class="product-desc">{{item.description}}</view>
            <view class="product-footer">
              <view class="product-price">￥{{item.price}}</view>
              <t-button 
                size="small" 
                theme="primary" 
                data-id="{{item.id}}"
                bindtap="onAddToCart"
                catchtap="onAddToCart"
              >
                +
              </t-button>
            </view>
          </view>
        </view>
      </t-grid-item>
    </t-grid>
    
    <view wx:if="{{!loading && products.length === 0}}" class="empty-state">
      <text>暂无商品</text>
    </view>
  </view>
</view>