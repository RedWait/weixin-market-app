<!--pages/product-detail/product-detail.wxml-->
<navigation-bar title="å•†å“è¯¦æƒ…" showBack="{{true}}" textColor="black" backgroundColor="white" />

<!-- åŠ è½½çŠ¶æ€ -->
<view wx:if="{{loading}}" class="loading-container">
  <text>åŠ è½½ä¸­...</text>
</view>

<!-- ä¸»å†…å®¹ -->
<view wx:else class="container">
  <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
  <view class="image-section">
    <swiper 
      class="image-swiper" 
      indicator-dots="{{true}}"
      indicator-color="rgba(255,255,255,0.5)"
      indicator-active-color="#fff"
      bindchange="onSwiperChange"
    >
      <swiper-item wx:for="{{product.images}}" wx:key="*this">
        <image 
          src="{{item}}" 
          mode="aspectFill" 
          class="product-image"
          data-src="{{item}}"
          bindtap="onImagePreview"
        />
      </swiper-item>
    </swiper>
    <view class="image-indicator">
      {{selectedImageIndex + 1}}/{{product.images.length}}
    </view>
  </view>

  <!-- å•†å“åŸºæœ¬ä¿¡æ¯ -->
  <view class="product-basic">
    <view class="product-price">ï¿¥{{product.price}}</view>
    <view class="product-title">{{product.name}}</view>
    <view class="product-desc">{{product.description}}</view>
    <view class="product-meta">
      <text class="meta-item">å“ç‰Œï¼š{{product.brand}}</text>
      <text class="meta-item">åº“å­˜ï¼š{{product.stock}}{{product.unit}}</text>
    </view>
  </view>

  <!-- è§„æ ¼é€‰æ‹© -->
  <view wx:if="{{product.specs && product.specs.length > 0}}" class="spec-section">
    <view class="section-title">é€‰æ‹©è§„æ ¼</view>
    <view wx:for="{{product.specs}}" wx:key="name" class="spec-group">
      <view class="spec-name">{{item.name}}</view>
      <view class="spec-options">
        <view 
          wx:for="{{item.options}}" 
          wx:for-item="option"
          wx:key="*this"
          class="spec-option {{selectedSpecs[item.name] === option ? 'selected' : ''}}"
          data-spec-name="{{item.name}}"
          data-option="{{option}}"
          bindtap="onSpecSelect"
        >
          {{option}}
        </view>
      </view>
    </view>
  </view>

  <!-- å•†å“è¯¦ç»†ä¿¡æ¯ -->
  <view class="detail-info">
    <view class="section-title">å•†å“ä¿¡æ¯</view>
    <view class="info-list">
      <view class="info-item">
        <text class="info-label">å•†å“åç§°</text>
        <text class="info-value">{{product.name}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">å“ç‰Œ</text>
        <text class="info-value">{{product.brand}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">å•ä½</text>
        <text class="info-value">{{product.unit}}</text>
      </view>
      <view wx:if="{{product.detailInfo}}" class="info-item">
        <text class="info-label">ç”Ÿäº§æ—¥æœŸ</text>
        <text class="info-value">{{product.detailInfo.productionDate}}</text>
      </view>
      <view wx:if="{{product.detailInfo}}" class="info-item">
        <text class="info-label">ä¿è´¨æœŸ</text>
        <text class="info-value">{{product.detailInfo.expiryDate}}</text>
      </view>
      <view wx:if="{{product.detailInfo}}" class="info-item">
        <text class="info-label">äº§åœ°</text>
        <text class="info-value">{{product.detailInfo.origin}}</text>
      </view>
      <view wx:if="{{product.detailInfo}}" class="info-item">
        <text class="info-label">ç”Ÿäº§å•†</text>
        <text class="info-value">{{product.detailInfo.manufacturer}}</text>
      </view>
      <view wx:if="{{product.detailInfo}}" class="info-item">
        <text class="info-label">é…æ–™è¡¨</text>
        <text class="info-value">{{product.detailInfo.ingredients}}</text>
      </view>
    </view>
  </view>

  <!-- è¥å…»æˆåˆ† -->
  <view wx:if="{{product.detailInfo && product.detailInfo.nutrition}}" class="nutrition-section">
    <view class="section-title">è¥å…»æˆåˆ†è¡¨</view>
    <view class="nutrition-list">
      <view class="nutrition-item">
        <text class="nutrition-label">èƒ½é‡</text>
        <text class="nutrition-value">{{product.detailInfo.nutrition.energy}}</text>
      </view>
      <view class="nutrition-item">
        <text class="nutrition-label">è›‹ç™½è´¨</text>
        <text class="nutrition-value">{{product.detailInfo.nutrition.protein}}</text>
      </view>
      <view class="nutrition-item">
        <text class="nutrition-label">è„‚è‚ª</text>
        <text class="nutrition-value">{{product.detailInfo.nutrition.fat}}</text>
      </view>
      <view class="nutrition-item">
        <text class="nutrition-label">ç¢³æ°´åŒ–åˆç‰©</text>
        <text class="nutrition-value">{{product.detailInfo.nutrition.carbohydrate}}</text>
      </view>
      <view class="nutrition-item">
        <text class="nutrition-label">é’ </text>
        <text class="nutrition-value">{{product.detailInfo.nutrition.sodium}}</text>
      </view>
    </view>
  </view>

  <!-- å•†å“è¯¦ç»†æè¿° -->
  <view wx:if="{{product.detailDescription}}" class="description-section">
    <view class="section-title">å•†å“è¯¦æƒ…</view>
    <view class="description-content">
      {{product.detailDescription}}
    </view>
  </view>

  <!-- æœåŠ¡ä¿éšœ -->
  <view class="service-section">
    <view class="section-title">æœåŠ¡ä¿éšœ</view>
    <view class="service-list">
      <view class="service-item">
        <text class="service-icon">âœ“</text>
        <text class="service-text">æ­£å“ä¿éšœ</text>
      </view>
      <view class="service-item">
        <text class="service-icon">âœ“</text>
        <text class="service-text">å¿«é€Ÿé…é€</text>
      </view>
      <view class="service-item">
        <text class="service-icon">âœ“</text>
        <text class="service-text">å”®åæœåŠ¡</text>
      </view>
    </view>
  </view>
</view>

<!-- åº•éƒ¨æ“ä½œæ  -->
<view class="bottom-bar">
  <view class="action-buttons">
    <view class="contact-service" bindtap="onContactService">
      <text class="action-icon">ğŸ“</text>
      <text class="action-text">å®¢æœ</text>
    </view>
    <view class="favorite" bindtap="onToggleFavorite">
      <text class="action-icon">â™¥</text>
      <text class="action-text">æ”¶è—</text>
    </view>
  </view>
  <view class="purchase-buttons">
    <view class="add-cart-btn" bindtap="onAddToCart">
      åŠ å…¥è´­ç‰©è½¦
    </view>
    <view class="buy-now-btn" bindtap="onBuyNow">
      ç«‹å³è´­ä¹°
    </view>
  </view>
</view>

<!-- è§„æ ¼é€‰æ‹©æ¨¡æ€æ¡† -->
<view wx:if="{{showSpecModal}}" class="spec-modal">
  <view class="spec-mask" bindtap="hideSpecModal"></view>
  <view class="spec-content">
    <view class="spec-header">
      <view class="spec-product">
        <image src="{{product.images[0]}}" class="spec-product-image" />
        <view class="spec-product-info">
          <view class="spec-product-price">ï¿¥{{product.price}}</view>
          <view class="spec-product-name">{{product.name}}</view>
        </view>
      </view>
      <view class="spec-close" bindtap="hideSpecModal">Ã—</view>
    </view>
    
    <view class="spec-body">
      <!-- è§„æ ¼é€‰æ‹© -->
      <view wx:for="{{product.specs}}" wx:key="name" class="spec-group">
        <view class="spec-name">{{item.name}}</view>
        <view class="spec-options">
          <view 
            wx:for="{{item.options}}" 
            wx:for-item="option"
            wx:key="*this"
            class="spec-option {{selectedSpecs[item.name] === option ? 'selected' : ''}}"
            data-spec-name="{{item.name}}"
            data-option="{{option}}"
            bindtap="onSpecSelect"
          >
            {{option}}
          </view>
        </view>
      </view>
      
      <!-- æ•°é‡é€‰æ‹© -->
      <view class="quantity-section">
        <view class="quantity-label">æ•°é‡</view>
        <view class="quantity-controls">
          <view class="quantity-btn" bindtap="onQuantityDecrease">-</view>
          <input 
            class="quantity-input" 
            type="number" 
            value="{{quantity}}"
            bindinput="onQuantityInput"
          />
          <view class="quantity-btn" bindtap="onQuantityIncrease">+</view>
        </view>
      </view>
    </view>
    
    <view class="spec-footer">
      <view class="confirm-btn" bindtap="onConfirmSpec">
        ç¡®å®š
      </view>
    </view>
  </view>
</view>